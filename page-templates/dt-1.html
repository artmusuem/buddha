<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Buddhist Artifact ‚Äì Buddha Museum</title>
  
  <!-- Single, consolidated environment setup script -->
  <script>
    // Consolidated environment detection - runs first, before everything else
    (function() {
      const isGitHub = window.location.hostname.includes('github.io');
      const basePath = isGitHub ? '/buddha' : '';
      
      console.log(`üåç Environment: ${isGitHub ? 'GitHub Pages' : 'Netlify'}, Base path: "${basePath}"`);
      
      // Store globally for immediate use
      window.SITE_BASE_PATH = basePath;
      window.IS_GITHUB = isGitHub;
      
      // Create and append CSS link with correct path immediately
      const cssLink = document.createElement('link');
      cssLink.rel = 'stylesheet';
      cssLink.href = `${basePath}/css/style.css`;
      cssLink.id = 'main-css';
      document.head.appendChild(cssLink);
      
      console.log('üì± CSS path set to:', cssLink.href);
    })();
  </script>

  <!-- Read more functionality -->
  <script>
    function applyReadMore(element) {
        const text = element.textContent.trim();
        if (!text || text === 'Loading...' || text.split(' ').length <= 25) return;
        
        const words = text.split(' ');
        const short = words.slice(0, 25).join(' ');
        
        element.innerHTML = short + '... <span class="read-more-btn" style="color:#8B4513;cursor:pointer;text-decoration:underline;font-weight:bold">read more</span>';
        
        element.querySelector('.read-more-btn').onclick = function() {
            element.innerHTML = text + ' <span class="read-less-btn" style="color:#8B4513;cursor:pointer;text-decoration:underline;font-weight:bold">show less</span>';
            element.querySelector('.read-less-btn').onclick = function() {
                applyReadMore(element);
            };
        };
    }
  </script>
</head>

<body class="statue-page">
  <div id="menu-placeholder"></div>
  
  <header class="site-header">
    <div class="header-content">
      <h1 class="museum-title">Buddha Museum</h1>
      <div class="search-bar">
        <input type="text" id="searchBox" placeholder="Search Buddhist artifacts..." />
        <button id="searchButton">üîç</button>
        <div id="searchResults"></div>
      </div>
    </div>
  </header>

  <nav class="statue-nav">
    <a href="#" class="nav-prev">‚Üê Previous Artifact</a>
    <a href="#" class="nav-gallery" id="gallery-link">üèõ Gallery Overview</a>
    <a href="#" class="nav-next">Next Artifact ‚Üí</a>
  </nav>

  <main class="artwork-main">
    <!-- Hero Section with Main Image and Basic Info -->
    <section class="artwork-hero">
      <div class="artwork-image-container">
        <img src="#" alt="Loading Artifact" class="statue-image lightbox-trigger" id="main-image" />
        <div class="image-caption">
          <span class="sku" id="artifact-sku">Loading...</span>
        </div>
      </div>
      
      <div class="artwork-primary-info">
        <header class="artwork-header">
          <h1 class="statue-title" id="artifact-title">Loading...</h1>
          <h2 class="subtitle" id="artifact-subtitle">Loading...</h2>
          <div class="artwork-meta-basic">
            <span class="medium" id="artifact-medium">Loading...</span>
          </div>
        </header>
        
        <div class="artwork-description">
          <p class="essay" id="artifact-essay">Loading...</p>
        </div>

        <!-- Key Details Grid -->
        <div class="details-grid">
          <div class="detail-item">
            <label>Dimensions</label>
            <span class="dimensions" id="artifact-dimensions">Loading...</span>
          </div>
          <div class="detail-item">
            <label>Medium</label>
            <span class="medium" id="artifact-medium-detail">Loading...</span>
          </div>
          <div class="detail-item">
            <label>Estimate</label>
            <span class="estimate" id="artifact-estimate">Loading...</span>
          </div>
          <div class="detail-item">
            <label>Price Realized</label>
            <span class="price-realized" id="artifact-price">Loading...</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Provenance and Auction Details Section -->
    <section class="auction-details">
      <h3>Auction Information & Provenance</h3>
      <div class="auction-content">
        <div class="provenance-history">
          <h4>Provenance</h4>
          <p class="provenance" id="artifact-provenance">Loading...</p>
        </div>
        <div class="lot-details">
          <h4>Lot Information</h4>
          <div class="lot-grid">
            <div class="lot-item">
              <label>Original Lot</label>
              <a href="#" class="lot-link" id="christies-link" target="_blank">View on Christie's</a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Tags and Categories -->
    <section class="artwork-metadata">
     <h3>Categories & Tags</h3>
     <div class="metadata-content">
       <div class="tags-container">
         <h4>Tags</h4>
         <ul class="tags-list">
           <li><a href="#" class="tag-link gallery-tag-link" data-filter="gandharan">Gandharan Art</a></li>
           <li><a href="#" class="tag-link gallery-tag-link" data-filter="tibetan">Tibetan Art</a></li>
           <li><a href="#" class="tag-link gallery-tag-link" data-filter="chinese">Chinese Art</a></li>
           <li><a href="#" class="tag-link gallery-tag-link" data-filter="head">Buddha Heads</a></li>
           <li><a href="#" class="tag-link gallery-tag-link" data-filter="stucco">Stucco Works</a></li>
           <li><a href="#" class="tag-link gallery-tag-link" data-filter="bronze">Bronze Works</a></li>
           <li><a href="#" class="tag-link gallery-tag-link" data-filter="ancient">Ancient Period</a></li>
           <li><a href="#" class="tag-link gallery-tag-link" data-filter="painting">Paintings</a></li>
         </ul>
       </div>
       
       <div class="filters-container">
         <h4>Classification</h4>
         <div class="filters-grid">
           <div class="filter-item">
             <label>Medium</label>
             <span class="medium-filter" id="filter-medium">Loading...</span>
           </div>
           <div class="filter-item">
             <label>Region/Origin</label>
             <span class="region-filter" id="filter-region">Loading...</span>
           </div>
           <div class="filter-item">
             <label>Time Period</label>
             <span class="period-filter" id="filter-period">Loading...</span>
           </div>
           <div class="filter-item">
             <label>Object Type</label>
             <span class="type-filter" id="filter-type">Loading...</span>
           </div>
         </div>
       </div>
     </div>
    </section>

    <!-- Authentication Badge -->
    <section class="provenance-section">
      <h3>Authentication & Documentation</h3>
      <div class="provenance-content">
        <div class="authentication-badge">
          <span class="verified-icon">‚úì</span>
          <p>This artifact has been documented from a reputable auction house with established provenance.</p>
        </div>
        <div class="document-links">
          <a href="#" class="lot-link template-link" id="original-listing-link" target="_blank">
            üîó View Original Christie's Listing
          </a>
        </div>
      </div>
    </section>

    <!-- Expert Commentary -->
    <section class="expert-commentary">
      <div class="curator-profile">
        <div class="profile-image">
          <img src="#" alt="Curator Profile" id="curator-image" />
        </div>
        <div class="profile-info">
          <h4>Expert Commentary</h4>
          <h5>Dr. Sarah Chen</h5>
          <p class="title">Senior Curator of Asian Art, Buddha Museum</p>
          <p class="commentary">"This remarkable piece exemplifies the artistic traditions that define Buddhist art across cultures and centuries, showing the synthesis of local and Buddhist artistic elements."</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="footer-content">
      <div class="footer-branding">
        <h2>Buddha Museum</h2>
        <p>Preserving and sharing the wisdom of Buddhist art across cultures</p>
      </div>
      <div class="footer-links">
        <a href="#" class="footer-gallery-link">Gallery</a>
        <a href="#">About</a>
        <a href="#">Collections</a>
        <a href="#">Research</a>
      </div>
    </div>
    <div class="footer-bottom">
      <p>¬© 2025 Buddha Museum. All Rights Reserved.</p>
    </div>
  </footer>

  <!-- Lightbox for Image Viewing -->
  <div class="lightbox" id="lightbox">
    <span class="lightbox-close">√ó</span>
    <div class="lightbox-content">
      <img src="" alt="Lightbox Image" class="lightbox-image" />
      <div class="lightbox-info">
        <h3 class="lightbox-title">Artifact Title</h3>
        <p class="lightbox-details">Artifact Details</p>
      </div>
    </div>
  </div>

  <!-- Main application script - loads after DOM -->
  <script>
    // Improved, reliable data fetching with better error handling
    class BuddhaDataLoader {
      constructor() {
        this.dataCache = null;
        this.basePath = window.SITE_BASE_PATH || '';
        this.isGitHub = window.IS_GITHUB || false;
      }

      async fetchBuddhaData() {
        if (this.dataCache) {
          console.log('üì¶ Using cached data');
          return this.dataCache;
        }

        const possiblePaths = [
          `${this.basePath}/data/buddha-collection.json`,
          '/data/buddha-collection.json',
          './data/buddha-collection.json',
          '../data/buddha-collection.json'
        ];

        console.log('üîç Attempting to load data from multiple paths...');
        
        for (const path of possiblePaths) {
          try {
            console.log(`  Trying: ${path}`);
            
            const response = await fetch(path, {
              method: 'GET',
              headers: {
                'Content-Type': 'application/json',
                'Cache-Control': 'no-cache'
              }
            });
            
            if (response.ok) {
              const data = await response.json();
              console.log(`‚úÖ Successfully loaded data from: ${path}`);
              console.log(`üìä Loaded ${data.length} items`);
              
              this.dataCache = data.filter(item => item.status !== "hide");
              return this.dataCache;
            } else {
              console.log(`‚ùå ${path} - HTTP ${response.status}: ${response.statusText}`);
            }
          } catch (error) {
            console.log(`‚ùå ${path} - Error: ${error.message}`);
          }
        }
        
        throw new Error("Could not load buddha-collection.json from any location");
      }

      updatePageContent(item) {
        console.log('üñºÔ∏è Updating page content with item:', item.sku);
        
        // Update all text content
        this.safeUpdate('artifact-title', item.title || 'Untitled Artifact');
        this.safeUpdate('artifact-subtitle', item.subtitle || '');
        this.safeUpdate('artifact-medium', item.medium || 'Unknown Medium');
        this.safeUpdate('artifact-medium-detail', item.medium || 'Unknown Medium');
        this.safeUpdate('artifact-dimensions', item.dimensions || 'Not specified');
        this.safeUpdate('artifact-estimate', item.estimate || 'Not available');
        this.safeUpdate('artifact-price', item.price_realized || 'Not available');
        this.safeUpdate('artifact-provenance', item.provenance || 'Provenance information not available');
        this.safeUpdate('artifact-sku', item.sku || '');
        
        // Update essay with read more functionality
        const essayElement = document.getElementById('artifact-essay');
        if (essayElement && item.essay) {
          essayElement.textContent = item.essay;
          applyReadMore(essayElement);
        }
        
        // Update images with proper paths
        this.updateImage('main-image', item.image, item.title || 'Buddhist Artifact');
        this.updateImage('curator-image', `${this.basePath}/images/curator-profile.jpg`, 'Curator Profile');
        
        // Update links
        this.updateLinks(item);
        
        // Update filters
        this.updateFilters(item);
        
        console.log('‚úÖ Page content updated successfully');
      }

      safeUpdate(elementId, content) {
        const element = document.getElementById(elementId);
        if (element) {
          element.textContent = content;
        } else {
          console.warn(`‚ö†Ô∏è Element not found: ${elementId}`);
        }
      }

      updateImage(elementId, imagePath, altText) {
        const element = document.getElementById(elementId);
        if (element && imagePath) {
          // Handle both absolute and relative paths
          const fullPath = imagePath.startsWith('http') ? imagePath : `${this.basePath}${imagePath}`;
          element.src = fullPath;
          element.alt = altText;
          console.log(`üñºÔ∏è Updated ${elementId} to: ${fullPath}`);
        } else if (element) {
          element.src = `${this.basePath}/images/placeholder.jpg`;
          element.alt = altText;
        }
      }

      updateLinks(item) {
        // Update gallery links
        const galleryLinks = document.querySelectorAll('.gallery-tag-link, .nav-gallery, .footer-gallery-link');
        galleryLinks.forEach(link => {
          link.href = `${this.basePath}/`;
          if (link.dataset.filter) {
            link.onclick = () => {
              sessionStorage.setItem('autoFilter', link.dataset.filter);
              return true;
            };
          }
        });

        // Update Christie's link
        const christiesLink = document.getElementById('christies-link');
        if (christiesLink && item.lot_link) {
          christiesLink.href = item.lot_link;
        }

        // Update original listing link
        const originalListingLink = document.getElementById('original-listing-link');
        if (originalListingLink && item.sku) {
          originalListingLink.href = `${this.basePath}/page-templates/dt-2.html?sku=${item.sku}`;
        }
      }

      updateFilters(item) {
        this.safeUpdate('filter-medium', item.medium || 'Unknown');
        this.safeUpdate('filter-region', item.region || 'Unknown');
        this.safeUpdate('filter-period', item.period || 'Unknown');
        this.safeUpdate('filter-type', item.object_type || 'Unknown');
      }

      async initializePage() {
        try {
          console.log('üöÄ Initializing Buddha Museum page...');
          
          // Get SKU from URL parameters
          const params = new URLSearchParams(window.location.search);
          const sku = params.get("sku");
          
          if (!sku) {
            console.log('‚ö†Ô∏è No SKU parameter found in URL');
            this.showError('No artifact specified');
            return;
          }
          
          console.log(`üîç Loading artifact with SKU: ${sku}`);
          
          // Load data
          const data = await this.fetchBuddhaData();
          const item = data.find(artifact => artifact.sku === sku);
          
          if (!item) {
            console.log(`‚ùå Artifact not found: ${sku}`);
            this.showError(`Artifact "${sku}" not found`);
            return;
          }
          
          // Update page content
          this.updatePageContent(item);
          
          // Initialize lightbox functionality
          this.initializeLightbox();
          
          console.log('üéâ Page initialization complete!');
          
        } catch (error) {
          console.error('üí• Failed to initialize page:', error);
          this.showError('Failed to load artifact data');
        }
      }

      showError(message) {
        document.getElementById('artifact-title').textContent = 'Error Loading Artifact';
        document.getElementById('artifact-subtitle').textContent = message;
      }

      initializeLightbox() {
        const lightbox = document.getElementById('lightbox');
        const lightboxImage = document.querySelector('.lightbox-image');
        const lightboxClose = document.querySelector('.lightbox-close');
        const mainImage = document.getElementById('main-image');

        if (mainImage) {
          mainImage.onclick = () => {
            lightboxImage.src = mainImage.src;
            lightbox.classList.add('active');
          };
        }

        if (lightboxClose) {
          lightboxClose.onclick = () => {
            lightbox.classList.remove('active');
          };
        }

        if (lightbox) {
          lightbox.onclick = (e) => {
            if (e.target === lightbox) {
              lightbox.classList.remove('active');
            }
          };
        }
      }
    }

    // Initialize when DOM is ready
    document.addEventListener("DOMContentLoaded", () => {
      console.log('üìÑ DOM Content Loaded - Starting initialization...');
      const loader = new BuddhaDataLoader();
      loader.initializePage();
    });

    // Fallback initialization with slight delay (for Netlify timing issues)
    setTimeout(() => {
      if (document.getElementById('artifact-title').textContent === 'Loading...') {
        console.log('‚è∞ Fallback initialization triggered');
        const loader = new BuddhaDataLoader();
        loader.initializePage();
      }
    }, 1000);
  </script>

  <style>
    /* Enhanced Professional Styling for Buddha Museum */
    .statue-page {
      font-family: 'Georgia', 'Times New Roman', serif;
      line-height: 1.6;
      color: #333;
      background-color: #fafafa;
    }

    .site-header {
      background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
      color: white;
      padding: 1rem 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .museum-title {
      font-size: 2rem;
      font-weight: 300;
      color: #fff;
      display: block;
